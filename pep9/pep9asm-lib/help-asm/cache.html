<!DOCTYPE HTML PUBLIC "-//W3C/DTD HTML 5.2//EN">

<html>
<head>
 <title> Pep/9: Cache Documentation </title>
  <style type="text/css" media="all">
   code { font-family:Courier, 'Courier New', monospace; font-size:11pt }
   pre { font-family:Courier; font-size:11pt }
   img { vertical-align:text-top; }
   h4 { margin-bottom: 0; border-bottom-width: 0; padding-bottom: 0; }
  </style>
</head>
<body bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#0000FF" alink="#0000FF">
<table bgcolor="#FB9F14" width="100%" cellpadding="2" cellspacing="0" border="0">
<tr><td>
<p style="text-align:center; font-family:helvetica, arial, sans-serif; font-size:14pt; font-weight:bold; color: #29315E">
Pep/9 Cache
</p>
</td></tr>
</table>
<p>
Reference: <i>Computer Systems</i>, Chapter 12, Section 12.2.
<p>
The Pep/9 system provides a cache simulator that visually displays the content of a cache.
It can simulate the direct-mapped cache in Figure 12.28 of <i>Computer Systems</i> and set-associtive caches like the one in Figure 12.30.
The cache write policy for a cache hit is <i>write through</i> as in Figure 12.31(a).
The cache write policy for a cache miss is <i>without write allocation</i> as in Figure 12.32(a).
<p>
 <a name="Topics">Topics:</a>
 <a href="#Using">Using the cache simulator</a>,
 <a href="#Fully">Fully associative caches</a>,
 <a href="#Stats">Cache statistics</a>,
 <a href="#Policies">Cache replacement policies</a>,
 <a href="#AddrCalc">Address translation calculator</a>.

<h3><a name="Using">Using the cache simulator</a></h3>

Access the cache simulator by clicking the Cache tab on the Memory pane.
<p>
<img src="qrc:/help-asm/images/cachetab.png" alt="cachetab" hspace=10 vspace=10>
<p>
Configure the cache by setting the number of bits in the Tag field and the number of bits in the Line field.
Because Pep/9 is a 16-bit computer, the number of bits in the Byte field is computed so that the sum of the number of bits in the three fields is 16.
The associativity of the cache is set independently of the number of bits in the three fields.
The following figure shows the settings for the four-way set-associative cache in Figure 12.30 of <i>Computer Systems</i>.
<p>
<img src="qrc:/help-asm/images/cacheconfiguration.png" alt="cacheconfiguration" hspace=10 vspace=10>
<p>
Set the cache replacement policy with the dropdown menu.
LRU is the Least Recently Used replacement policy.
See  <a href="#Policies">Cache replacement policies</a> for a description of each policy.
<p>
<img src="qrc:/help-asm/images/cachereplacement.png" alt="cachereplacement" hspace=10 vspace=10>
<p>
The following is a sequence of single steps in Debug mode of Figure 6.42 that explains the visual display of the cache after each step.
Here is the state at the beginning of the trace.
<p>
<img src="qrc:/help-asm/images/cachetrace01.png" alt="cachetrace01" hspace=10 vspace=10>
<p>
The <code>BR</code> instruction at 0000 is about to execute.
<h4>Step 1.</h4>
<p>
<img src="qrc:/help-asm/images/cachetrace02.png" alt="cachetrace02" hspace=10 vspace=10>
<p>
The <code>BR</code> instruction at 0000 executes.
The <code>LDWA</code> instruction at 0009 will execute next.
Before execution of <code>BR</code>, the cache is empty.
Execution of <code>BR</code> consists of one von Neumann cycle: fetch instruction into IR, decode instruction, increment PC, execute instruction stored in IR.
<p>
In the fetch part of the cycle, the CPU requests the instruction specifier, which is the first byte of the 3-byte instruction.
The first byte is a cache miss, because the cache is initially empty, which triggers a memory read of the 16-byte block from address 0000 into the first set of the 4-way set-associative cache.
When the instruction is decoded, the CPU detects that <code>BR</code> is a nonunary 3-byte instruction.
Therefore, it requests the operand specifier bytes at addresses 0001 and 0002.
These two bytes were just prefetched into the cache, and so additional memory references are not required.
<p>
In the execution part of the von Neumann cycle, no memory accesses are required because the RTL specification of <code>BR</code> is PC&larr;Oprnd.
<code>BR</code> uses immediate addressing.
So, the operand specifier <i>is</i> the operand, which is already contained in the IR, and no additional memory accesses are required.
<p>
Here is the cache view after the first step.
<p>
<img src="qrc:/help-asm/images/cachetrace03.png" alt="cachetrace03" hspace=10 vspace=10>
<p>
Because this is a 4-way set-associative cache, each entry (<i>i.e.</i> line) in the cache table is a set of four blocks from memory.
Each block in the above cache view is on a separate row.
<p>
The first column displays the Line number.
Because there are three line bits and 2<sup>3</sup>=8, the cache table has 8 entries and the cache line number will be a value in the range 0..7.
In this step, the line number is 0.
The figure does not show the remaining seven lines.
<p>
The second column displays the Valid bit.
The valid bit of the first element in the set is 1, or true, indicating that the first element contains a valid copy of the data from main memory.
<p>
The third column displays the Tag number.
Because there are 9 tag bits and 2<sup>9</sup>=512, there are 512 16-byte blocks in main memory that map into each entry of the cache table, and the Tag number will be a value in the range 0..511.
In this step, the tag number is 0.
<p>
The physical content of the cache consists of the valid bit, the tag field, and the copy of the block from memory.
The cache view does not display the copy of the block directly.
If you want to see the block from memory, right-click the entry in the cache view.
<p>
<img src="qrc:/help-asm/images/cachetrace04.png" alt="cachetrace04" hspace=10 vspace=10>
<p>
The fourth column displays the range of main memory addresses covered by the block.
In this example, the block contains the 16 bytes from main memory addresses 0000 to 000F.
<p>
The fifth column displays the number of memory references thus far in the execution.
Each entry in the cache table is initially loaded because of a cache miss.
Each subsequent reference to prefetched bytes is a cache hit.
Therefore, the number of cache hits is always the number of cache references minus one.
<p>
In this step, the number of references is three, which means there was one cache miss and two cache hits.
The first cache miss was the fetch of the instruction specifier byte.
The two cache hits were the fetch of the two bytes of the operand specifier that were preloaded into the cache during the cache miss.
<p>
The sixth column is only relevant when the set is full and a cache miss requires a new block to be copied into that line.
If all the valid bits are true, the Next Victim column shows which element from the set will be replaced.
<p>
<h4>Step 2.</h4>
<p>
<img src="qrc:/help-asm/images/cachetrace05.png" alt="cachetrace05" hspace=10 vspace=10>
<p>
The <code>LDWA</code> instruction at 0009 executes.
The <code>CALL</code> instruction at 000C will execute next.
<p>
Here is the cache view after the second step.
<p>
<img src="qrc:/help-asm/images/cachetrace06.png" alt="cachetrace06" hspace=10 vspace=10>
<p>
Because the <code>LDWA</code> instruction uses immediate addressing, all memory references were preloaded into the cache.
All three references were hits.
So, the only change to the cache is an increase of references from 3 to 6.
<p>
<h4>Step 3.</h4>
<p>
<img src="qrc:/help-asm/images/cachetrace07.png" alt="cachetrace07" hspace=10 vspace=10>
<p>
The <code>CALL</code> instruction at 000C executes.
The <code>LDWX</code> instruction at 0073 will execute next.
<p>
Here is the cache view after the third step.
<p>
<img src="qrc:/help-asm/images/cachetrace08.png" alt="cachetrace08" hspace=10 vspace=10>
<p>
Because the <code>LDWA</code> instruction uses immediate addressing, all memory references were preloaded into the cache.
All three references were hits.
So, the only change to the cache is an increase of references from 3 to 6.
<h4>Step 4.</h4>
<p>
<img src="qrc:/help-asm/images/cachetrace11.png" alt="cachetrace11" hspace=10 vspace=10>
<p>
The <code>LDWX</code> instruction at 0073 executes.
The <code>ADDX</code> instruction at 0076 will execute next.
<p>
Here is the cache view after the fourth step.
<p>
<img src="qrc:/help-asm/images/cachetrace12.png" alt="cachetrace12" hspace=10 vspace=10>
<p>
Step 4 commentary.
<h4>Step 5.</h4>
<p>
<img src="qrc:/help-asm/images/cachetrace13.png" alt="cachetrace13" hspace=10 vspace=10>
<p>
The <code>LDWA</code> instruction at 0009 executes.
The <code>CALL</code> instruction at 000C will execute next.
<p>
Here is the cache view after the third step.
<p>
<img src="qrc:/help-asm/images/cachetrace14.png" alt="cachetrace14" hspace=10 vspace=10>
<p>
<h4>Step 6.</h4>
<p>
<img src="qrc:/help-asm/images/cachetrace15.png" alt="cachetrace15" hspace=10 vspace=10>
<p>
The <code>LDWA</code> instruction at 0009 executes.
The <code>CALL</code> instruction at 000C will execute next.
<p>
Here is the cache view after the third step.
<p>
<img src="qrc:/help-asm/images/cachetrace16.png" alt="cachetrace16" hspace=10 vspace=10>
<p>







<a href="#Topics">Scroll to topics</a>.

<h3><a name="Fully">Fully associative caches</a></h3>

Fully associative caches material for Pep/9 cache goes here
<p>
More fully associative caches material for Pep/9 cache goes here
<p>
More fully associative caches material for Pep/9 cache goes here
<p>
More fully associative caches material for Pep/9 cache goes here
<p>
<a href="#Topics">Scroll to topics</a>.

<h3><a name="Stats">Cache statistics</a></h3>

Cache statistics material for Pep/9 cache goes here
<p>
More cache statistics material for Pep/9 cache goes here
<p>
More cache statistics material for Pep/9 cache goes here
<p>
More cache statistics material for Pep/9 cache goes here
<p>
<a href="#Topics">Scroll to topics</a>.

<h3><a name="Policies">Cache replacement policies</a></h3>

Cache replacement material for Pep/9 cache goes here
<p>
More cache replacement material for Pep/9 cache goes here
<p>
More cache replacement material for Pep/9 cache goes here
<p>
More cache replacement material for Pep/9 cache goes here
<p>
<a href="#Topics">Scroll to topics</a>.

<h3><a name="AddrCalc">Address translation calculator</a></h3>

Cache replacement material for address translation calculator goes here
<p>
More address translation calculator material for Pep/9 cache goes here
<p>
More address translation calculator material for Pep/9 cache goes here
<p>
More address translation calculator material for Pep/9 cache goes here
<p>
<a href="#Topics">Scroll to topics</a>.
<p>

</body>
</html>
